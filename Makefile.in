# Makefile for Sd (square dance caller's helper)
# Time-stamp: <93/07/02 16:47:00 wba>

srcdir = @srcdir@
TEXDIR = /TeX/bin

# This gives the compiler name and any switches that it needs to make it operate
# the way we want (ANSI language, standards conformance, target hardware, etc.)
CC = @CC@

# This gives any "-D" switches that we always need to send to the compiler.
FLAGS = @DEFS@

# This gives the optimization and/or debug info.  These flags presumably
# don't affect the semantics of the language and run-time environment, so you
# might reasonably want to change them to suit your taste.
# The options shown here have been chosen to optimize the program for
# production use.  Depending on your operating system, compiler, and debugger,
# this may compromise the ability to debug the program.  In this case, you may
# need to choose different options, typically "-g", for debugging.  Consult your
# system, compiler, and debugger vendor for further information.
CDEBUGFLAGS = @CDEBUGFLAGS@

CFLAGS = $(FLAGS) $(CDEBUGFLAGS)

# These are the "-I"  and "-D" flags that we must use for the compilation
# of the X11 user interface (sdui-x11.c).
X11_FLAGS = @X11_FLAGS@

# These are the "-I"  and "-D" flags that we must use for the compilation
# of the system-dependent part of the TTY user interface (sdui-ttu.c).
TTY_FLAGS = @TTY_FLAGS@

# These are the library flags that we must use for the final bind of
# the X11 version of "sd".
X11_LIBS = @X11_LIBS@

# These are the library flags that we must use for the final bind of
# "sdtty".
TTY_LIBS = @TTY_LIBS@

SD_SRCS = sdmain.c sdinit.c sdutil.c sdbasic.c \
          sdtables.c sdctable.c sdtop.c sdconcpt.c sdpreds.c sd12.c sd16.c \
          sdgetout.c sdmoves.c sdtand.c sdconc.c sdistort.c \
          sdsi.c

SD_OBJS = sdmain.o sdinit.o sdutil.o sdbasic.o \
          sdtables.o sdctable.o sdtop.o sdconcpt.o sdpreds.o sd12.o sd16.o \
          sdgetout.o sdmoves.o sdtand.o sdconc.o sdistort.o \
          sdsi.o

SDX11_SRC = sdui-x11.c
SDX11_OBJ = sdui-x11.o

TTY_DIST_SRCS = sdui-tty.c sdmatch.c sdui-ttu.c sdui-tpc.c
SDTTY_OBJ = @SDTTY_OBJ@

SDTTY_OBJS = @SDTTY_OBJS@

MKCALLS_SRCS = mkcalls.c dbcomp.c
MKCALLS_OBJS = mkcalls.o dbcomp.o

.SUFFIXES: .o .c .dvi .info .txinfo

.c.o:
	$(CC) $(CFLAGS) -c $(srcdir)/$*.c

all: @DEFAULT_TARGET@
allx11: sd sd_calls.dat
alltty: sdtty sd_calls.dat
everything: allx11 sdtty

sd: $(SD_OBJS) $(SDX11_OBJ)
	$(CC) $(CFLAGS) -o $@ $(SD_OBJS) $(SDX11_OBJ) $(X11_LIBS)

sdtty: $(SD_OBJS) $(SDTTY_OBJ)
	$(CC) $(CFLAGS) -o $@ $(SDTTY_OBJS) $(TTY_LIBS)
@STRIP@
@AOUT2EXE@

mkcalls: $(MKCALLS_OBJS)
	$(CC) $(CFLAGS) -o $@ $(MKCALLS_OBJS)
@STRIP@
@AOUT2EXE@

sd_calls.dat: sd_calls.txt mkcalls
	./mkcalls

@DMAKE_IMPLICIT@

# sdui-x11.c may need -D_POSIX_SOURCE with gcc 1.40 on Ultrix 4.2

sdui-x11.o: sdui-x11.c
	$(CC) $(CFLAGS) $(X11_FLAGS) -c $(srcdir)/$*.c

sdui-ttu.o: sdui-ttu.c
	$(CC) $(CFLAGS) $(TTY_FLAGS) -c $(srcdir)/$*.c

dbcomp.o sdmain.o sdsi.o sdui-x11.o: paths.h

dbcomp.o: database.h

$(SD_OBJS) $(SDX11_OBJ) $(SDTTY_OBJ): sd.h database.h

Makefile:: configure
	$(srcdir)/configure

Makefile:: Makefile.in config.status
	./config.status

info: sd_doc.info
dvi: sd_doc.dvi
PS: sd_doc.PS

sd_doc.info sd_doc.dvi: sd_doc.txinfo readme.txinfo install.txinfo

RM = rm -f

MAKEINFO = $(TEXDIR)/makeinfo --no-split
MAKE_ASCII = $(TEXDIR)/makeinfo --no-split --no-headers
TXI2DVI = $(TEXDIR)/tex
DVISELECT = $(TEXDIR)/dviselect
DVICONCAT = $(TEXDIR)/dviconcat
DVIPS = $(TEXDIR)/dvips

# We do it twice, so cross references will be reconciled.

.txinfo.dvi:
	$(TXI2DVI) $<
	$(TXI2DVI) $<

.txinfo.info:
	$(MAKEINFO) -I$(srcdir) $<

# TeX outputs front, body, toc; we want front, toc, body

sd_doc-sorted.dvi: sd_doc.dvi
	$(DVISELECT) -i sd_doc.dvi =1:2 > tempa.dvi
	$(DVISELECT) -i sd_doc.dvi :_1 > tempb.dvi
	($(DVISELECT) -i sd_doc.dvi -s 1: | $(DVISELECT) =3:) > tempc.dvi
	$(DVICONCAT) -o sd_doc-sorted.dvi tempa.dvi tempb.dvi tempc.dvi
	$(RM) tempa.dvi tempb.dvi tempc.dvi

sd_doc.PS: sd_doc-sorted.dvi
	$(DVIPS) -U -o sd_doc.PS sd_doc-sorted.dvi

INSTALL: install.txinfo
	$(MAKE_ASCII) -o $@ --no-validate $(srcdir)/install.txinfo

README: readme.txinfo
	$(MAKE_ASCII) -o $@ --no-validate $(srcdir)/readme.txinfo

clean::
	$(RM) $(MKCALLS_OBJS) $(SDX11_OBJ) $(SD_OBJS) $(SDTTY_OBJ) sd sdtty mkcalls sd_calls.dat sd.tar sd.tar.Z

LINT = /usr/lang/alint

lint:
	$(LINT) -ux $(SD_SRCS) $(SDX11_SRC)

DISTTXT = README INSTALL Relnotes oldnotes COPYING \
            Imakefile configure Makefile.in Sd.res sd_calls.txt \
            db_doc.txt sd_doc.txinfo readme.txinfo install.txinfo
DISTSRCS = sd.h database.h paths.h sdui-ttu.h \
            sdmatch.c sdmatch.h
DISTFILES = $(DISTTXT) $(SD_SRCS) $(SDX11_SRC) $(TTY_DIST_SRCS) \
            $(MKCALLS_SRCS) $(DISTSRCS)

TAR = tar cvf sd.tar

dist: INSTALL README
	$(TAR) $(DISTFILES)

ls:
	@echo $(DISTFILES)

bnarc:
	lharc a sd290bn readme install relnotes oldnotes copying \
	sd_calls.txt sd_calls.dat db_doc.txt \
	sdtty.exe mkcalls.exe go32.exe
	lharc s sd290bn

# end of Makefile from @TIME_STAMP@
